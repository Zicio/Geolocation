(()=>{"use strict";class t{static showMessage(e,o){if(!e||!o)return void t.showPopup();const s=document.getElementById("1"),n=s.value,r=document.querySelector(".tape__window"),a=t.setEl("div","tape__message");r.prepend(a);const p=t.setEl("span","message__text");p.textContent=n,a.append(p),s.value="";const i=t.setEl("span","message__date");i.textContent=`${t.getDate().day}.${t.getDate().month}.${t.getDate().year} ${t.getDate().hour}:${t.getDate().minute}`,a.append(i);const c=t.setEl("span","message__coords");c.textContent=`[${e}, ${o}]`,a.append(c)}static getDate(){const e=new Date,o=t.formatDate(e.getMonth()+1),s=t.formatDate(e.getDate());let n=t.formatDate(e.getHours());return 24===n&&(n=0),{month:o,day:s,hour:n,minute:t.formatDate(e.getMinutes()),year:+e.getFullYear().toString().slice(2)}}static formatDate(t){return t<10&&(t=`0${t}`),t}static showPopup(){const e=document.querySelector(".tape"),o=t.setEl("div","popup");e.before(o);const s=t.setEl("div","popup__text");o.append(s),s.insertAdjacentHTML("beforeend","<p>Что-то пошло не так</p><p>К сожалению, нам не удалось определить ваше местоположение, пожалуйста, дайте разрешение на использование геолокации, либо введите координаты вручную.</p><p>Широта и долгота через запятую</p>");const n=t.setEl("form","popup__form");n.setAttribute("action",""),n.setAttribute("method","post"),n.setAttribute("id","popup-form"),o.append(n);const r=t.setEl("input","form__input");n.append(r);const a=t.setEl("div","popup__button-panel");o.append(a);const p=t.setEl("button","button-panel__button","reset");p.setAttribute("form","popup-form"),p.setAttribute("type","button"),p.textContent="Отмена",a.append(p);const i=t.setEl("button","button-panel__button","submit");i.setAttribute("form","popup-form"),i.setAttribute("type","button"),i.textContent="Ок",a.append(i)}static hidePopup(){document.querySelector(".popup").remove()}static setEl(t,...e){const o=document.createElement(t);return o.classList.add(...e),o}static showHint(e){const o=e.target.closest(".popup").querySelector(".form__input"),s=o.closest(".popup__form");o.style.borderColor="red";const n=t.setEl("div","form__hint");n.textContent="Некорректное значение!",s.append(n),n.style.top=o.offsetTop+o.offsetHeight/2-n.offsetHeight/2+"px",n.style.left=`${o.offsetLeft+o.offsetWidth+5}px`}}class e{constructor(t){this.element=t,this.messageListener(),this.popupListener()}messageListener(){this.element.addEventListener("keydown",(t=>this.constructor.keyHandler(t)))}static keyHandler(t){"Enter"===t.code&&t.target.classList.contains("form__input")&&(t.preventDefault(),e.geolocation())}static geolocation(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(e.getCoords,e.getError,{enableHighAccuracy:!0})}static getCoords(e){const{latitude:o}=e.coords,{longitude:s}=e.coords;t.showMessage(o,s)}static getError(){t.showMessage()}popupListener(){this.element.addEventListener("click",(t=>this.constructor.clickHandler(t)))}static clickHandler(e){if(e.target.classList.contains("button-panel__button")){if(e.preventDefault(),e.target.classList.contains("reset"))return void t.hidePopup();const o=e.target.closest(".popup").querySelector(".form__input").value,s=class{static getCoords(t){const e=t.toString().replace("[","").replace("]","").replace(" ","").split(",",2),o=e[0],s=e[1],n=/-?\d{1,3}\.\d+/;return n.test(o)&&n.test(s)?{latitude:o,longitude:s}:null}}.getCoords(o);if(s)return t.showMessage(s.latitude,s.longitude),void t.hidePopup();t.showHint(e)}}}new e(document)})();